<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitoramento de Abastecimento - AGUADA</title>
    <link rel="stylesheet" href="assets/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        .supply-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .supply-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .supply-card h3 {
            color: var(--primary-blue);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .supply-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: var(--background-light);
            border-radius: 6px;
            margin-bottom: 15px;
        }

        .supply-indicator {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .supply-indicator.active {
            background: var(--success-green);
            animation: pulse 2s infinite;
        }

        .supply-indicator.inactive {
            background: var(--border-color);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .supply-info {
            flex: 1;
        }

        .supply-info .label {
            font-size: 12px;
            color: var(--text-muted);
        }

        .supply-info .value {
            font-size: 20px;
            font-weight: bold;
            color: var(--text-dark);
        }

        .event-list {
            list-style: none;
            padding: 0;
        }

        .event-item {
            padding: 12px;
            border-left: 4px solid var(--accent-purple);
            background: var(--background-light);
            margin-bottom: 10px;
            border-radius: 4px;
        }

        .event-item.supply {
            border-left-color: var(--success-green);
        }

        .event-item.consumption {
            border-left-color: var(--warning-orange);
        }

        .event-item.leak {
            border-left-color: var(--danger-red);
        }

        .event-time {
            font-size: 12px;
            color: var(--text-muted);
        }

        .event-desc {
            font-weight: 500;
            margin-top: 4px;
        }

        .progress-bar {
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-purple), var(--primary-blue));
            transition: width 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üíß Monitoramento de Abastecimento</h1>
            <nav>
                <a href="index.html">Dashboard</a>
                <a href="painel.html">Painel</a>
                <a href="dados.html">Dados</a>
                <a href="consumo.html">Consumo</a>
                <a href="abastecimento.html" class="active">Abastecimento</a>
                <a href="manutencao.html">Manuten√ß√£o</a>
                <a href="history.html">Hist√≥rico</a>
                <a href="alerts.html">Alertas</a>
                <a href="config.html">Config</a>
                <a href="system.html">Sistema</a>
            </nav>
        </header>

        <div class="supply-grid">
            <div class="supply-card">
                <h3>üö∞ Status de Abastecimento</h3>
                <div class="supply-status">
                    <div class="supply-indicator inactive" id="supplyIndicator">üíß</div>
                    <div class="supply-info">
                        <div class="label">Status Atual</div>
                        <div class="value" id="supplyStatus">Inativo</div>
                        <div class="event-time" id="supplyTime">√öltimo: --:--</div>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="font-size: 14px; color: var(--text-muted);">Volume abastecido hoje</span>
                        <span style="font-weight: bold;" id="volumeToday">0 m¬≥</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="volumeProgress" style="width: 0%"></div>
                    </div>
                    <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">
                        Meta di√°ria: <span id="dailyTarget">50 m¬≥</span>
                    </div>
                </div>
            </div>

            <div class="supply-card">
                <h3>‚è±Ô∏è Tempo de Abastecimento</h3>
                <div style="text-align: center; padding: 20px 0;">
                    <div style="font-size: 48px; font-weight: bold; color: var(--primary-blue);" id="supplyDuration">00:00:00</div>
                    <div style="color: var(--text-muted); margin-top: 8px;">Dura√ß√£o da sess√£o atual</div>
                </div>
                
                <div style="margin-top: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="font-size: 14px;">Taxa M√©dia:</span>
                        <span style="font-weight: bold;" id="avgRate">0 L/min</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="font-size: 14px;">Tempo Total (Hoje):</span>
                        <span style="font-weight: bold;" id="totalTime">0h 0min</span>
                    </div>
                </div>
            </div>

            <div class="supply-card">
                <h3>üéØ Previs√£o de Conclus√£o</h3>
                <div style="text-align: center; padding: 20px 0;">
                    <div style="font-size: 36px; font-weight: bold; color: var(--accent-purple);" id="estimatedTime">--:--</div>
                    <div style="color: var(--text-muted); margin-top: 8px;">Hor√°rio estimado (100%)</div>
                </div>
                
                <div style="margin-top: 20px; background: var(--background-light); padding: 15px; border-radius: 6px;">
                    <div style="font-size: 14px; margin-bottom: 8px;">
                        <strong>Reservat√≥rio Alvo:</strong> <span id="targetReservoir">RCON</span>
                    </div>
                    <div style="font-size: 14px; margin-bottom: 8px;">
                        <strong>N√≠vel Atual:</strong> <span id="currentLevel">0%</span>
                    </div>
                    <div style="font-size: 14px;">
                        <strong>Faltam:</strong> <span id="remainingVolume">0 m¬≥</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="supply-card" style="margin-bottom: 20px;">
            <h3>üìä Hist√≥rico de Abastecimento (√öltimos 7 dias)</h3>
            <canvas id="supplyHistoryChart"></canvas>
        </div>

        <div class="supply-card">
            <h3>üìã Eventos Recentes</h3>
            <ul class="event-list" id="eventList">
                <li class="event-item supply">
                    <div class="event-time">Hoje √†s 08:15</div>
                    <div class="event-desc">üü¢ Abastecimento iniciado - RCON (45% ‚Üí 87%)</div>
                </li>
                <li class="event-item consumption">
                    <div class="event-time">Ontem √†s 14:30</div>
                    <div class="event-desc">üü° Consumo detectado - RCON (92% ‚Üí 68%)</div>
                </li>
                <li class="event-item supply">
                    <div class="event-time">Ontem √†s 06:00</div>
                    <div class="event-desc">üü¢ Abastecimento conclu√≠do - RCAV (62% ‚Üí 95%)</div>
                </li>
                <li class="event-item consumption">
                    <div class="event-time">18/11 √†s 16:45</div>
                    <div class="event-desc">üü° Pico de consumo detectado - RCON (taxa: 450 L/h)</div>
                </li>
            </ul>
        </div>
    </div>

    <script src="assets/app.js"></script>
    <script>
        let supplyChart;
        let sessionStartTime = null;
        let durationInterval = null;

        // Initialize supply history chart
        function initSupplyChart() {
            const ctx = document.getElementById('supplyHistoryChart').getContext('2d');
            supplyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: generateDayLabels(7),
                    datasets: [
                        {
                            label: 'Volume Abastecido (m¬≥)',
                            data: generateMockSupplyData(7),
                            backgroundColor: 'rgba(16, 185, 129, 0.7)',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'N√∫mero de Sess√µes',
                            data: [3, 2, 4, 3, 2, 3, 2],
                            type: 'line',
                            borderColor: 'rgba(103, 126, 234, 1)',
                            backgroundColor: 'rgba(103, 126, 234, 0.1)',
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Volume (m¬≥)' },
                            position: 'left'
                        },
                        y1: {
                            beginAtZero: true,
                            title: { display: true, text: 'Sess√µes' },
                            position: 'right',
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // Update supply status
        function updateSupplyStatus() {
            // Mock detection - in production, check actual readings
            const isSupplying = Math.random() > 0.7;
            
            const indicator = document.getElementById('supplyIndicator');
            const status = document.getElementById('supplyStatus');
            
            if (isSupplying) {
                indicator.className = 'supply-indicator active';
                status.textContent = 'Abastecendo';
                status.style.color = 'var(--success-green)';
                
                if (!sessionStartTime) {
                    sessionStartTime = Date.now();
                    startDurationTimer();
                }
            } else {
                indicator.className = 'supply-indicator inactive';
                status.textContent = 'Inativo';
                status.style.color = 'var(--text-muted)';
                
                if (sessionStartTime) {
                    sessionStartTime = null;
                    stopDurationTimer();
                }
            }

            // Update stats
            const volumeToday = (Math.random() * 40 + 10).toFixed(1);
            const dailyTarget = 50;
            const progress = (volumeToday / dailyTarget) * 100;
            
            document.getElementById('volumeToday').textContent = `${volumeToday} m¬≥`;
            document.getElementById('volumeProgress').style.width = `${Math.min(progress, 100)}%`;
            
            document.getElementById('avgRate').textContent = `${(Math.random() * 200 + 50).toFixed(0)} L/min`;
            document.getElementById('totalTime').textContent = `${Math.floor(Math.random() * 8)}h ${Math.floor(Math.random() * 60)}min`;
            
            // Update prediction
            const currentLevel = Math.floor(Math.random() * 40 + 40);
            const remaining = ((100 - currentLevel) * 80 / 100).toFixed(1);
            
            document.getElementById('currentLevel').textContent = `${currentLevel}%`;
            document.getElementById('remainingVolume').textContent = `${remaining} m¬≥`;
            
            const now = new Date();
            const estimatedMinutes = Math.floor(Math.random() * 120 + 30);
            const estimated = new Date(now.getTime() + estimatedMinutes * 60000);
            document.getElementById('estimatedTime').textContent = estimated.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
        }

        function startDurationTimer() {
            durationInterval = setInterval(() => {
                if (sessionStartTime) {
                    const elapsed = Date.now() - sessionStartTime;
                    const hours = Math.floor(elapsed / 3600000);
                    const minutes = Math.floor((elapsed % 3600000) / 60000);
                    const seconds = Math.floor((elapsed % 60000) / 1000);
                    
                    document.getElementById('supplyDuration').textContent = 
                        `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                }
            }, 1000);
        }

        function stopDurationTimer() {
            if (durationInterval) {
                clearInterval(durationInterval);
                durationInterval = null;
            }
            document.getElementById('supplyDuration').textContent = '00:00:00';
        }

        function generateDayLabels(days) {
            const labels = [];
            for (let i = days - 1; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' }));
            }
            return labels;
        }

        function generateMockSupplyData(days) {
            return Array.from({length: days}, () => (Math.random() * 60 + 20).toFixed(1));
        }

        // Initialize
        initSupplyChart();
        updateSupplyStatus();
        
        // Update every 5 seconds
        setInterval(updateSupplyStatus, 5000);
    </script>
</body>
</html>
