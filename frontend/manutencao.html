<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CMMS - Manuten√ß√£o - AGUADA</title>
    <link rel="stylesheet" href="assets/style.css" />
    <style>
      .cmms-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
      }

      .cmms-card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .cmms-card h3 {
        color: var(--primary-blue);
        margin-bottom: 15px;
      }

      .maintenance-item {
        padding: 15px;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        margin-bottom: 10px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .maintenance-item:hover {
        border-color: var(--accent-purple);
        background: var(--background-light);
      }

      .maintenance-item.overdue {
        border-left: 4px solid var(--danger-red);
      }

      .maintenance-item.pending {
        border-left: 4px solid var(--warning-orange);
      }

      .maintenance-item.completed {
        border-left: 4px solid var(--success-green);
      }

      .maintenance-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }

      .maintenance-title {
        font-weight: 600;
        color: var(--text-dark);
      }

      .maintenance-badge {
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
      }

      .badge-overdue {
        background: #fee2e2;
        color: #991b1b;
      }

      .badge-pending {
        background: #fef3c7;
        color: #92400e;
      }

      .badge-completed {
        background: #d1fae5;
        color: #065f46;
      }

      .maintenance-details {
        font-size: 14px;
        color: var(--text-muted);
      }

      .stats-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .stat-box {
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .stat-box .number {
        font-size: 32px;
        font-weight: bold;
        margin: 8px 0;
      }

      .stat-box.overdue .number {
        color: var(--danger-red);
      }

      .stat-box.pending .number {
        color: var(--warning-orange);
      }

      .stat-box.completed .number {
        color: var(--success-green);
      }

      .stat-box .label {
        font-size: 12px;
        color: var(--text-muted);
      }

      .action-buttons {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }

      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.3s;
      }

      .btn-primary {
        background: var(--accent-purple);
        color: white;
      }

      .btn-primary:hover {
        background: var(--primary-blue);
      }

      .calendar-view {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
        margin-top: 15px;
      }

      .calendar-day {
        aspect-ratio: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .calendar-day:hover {
        background: var(--background-light);
      }

      .calendar-day.has-event {
        background: var(--accent-purple);
        color: white;
      }

      .calendar-day.today {
        border: 2px solid var(--primary-blue);
        font-weight: bold;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      }

      .modal.active {
        display: flex;
      }

      .modal-content {
        background: white;
        border-radius: 10px;
        padding: 30px;
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
        color: var(--text-dark);
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        font-size: 14px;
      }

      .form-group textarea {
        min-height: 100px;
        resize: vertical;
      }
    </style>
  </head>
  <body>
    <div class="admin-header">
      <div class="admin-header-top">
        <h1>üîß CMMS - Gest√£o de Manuten√ß√£o - AGUADA</h1>
        <div class="status-indicator">
          <div class="status-dot"></div>
          <span>‚óè Online</span>
        </div>
      </div>
      <nav class="admin-nav">
        <a href="index.html">Dashboard</a>
        <a href="mapa.html">Mapa</a>
        <a href="painel.html">Painel Visual</a>
        <a href="dados.html">Dados</a>
        <a href="consumo.html">Consumo</a>
        <a href="abastecimento.html">Abastecimento</a>
        <a href="manutencao.html" class="active">Manuten√ß√£o</a>
        <a href="history.html">Hist√≥rico</a>
        <a href="alerts.html">Alertas</a>
        <a href="config.html">Configura√ß√µes</a>
        <a href="system.html">Sistema</a>
        <a href="documentacao.html">Docs</a>
      </nav>
    </div>

    <div class="main-container">
      <div class="stats-row">
        <div class="stat-box overdue">
          <div class="label">Atrasadas</div>
          <div class="number" id="overdueCount">2</div>
        </div>
        <div class="stat-box pending">
          <div class="label">Pendentes</div>
          <div class="number" id="pendingCount">5</div>
        </div>
        <div class="stat-box completed">
          <div class="label">Conclu√≠das (M√™s)</div>
          <div class="number" id="completedCount">12</div>
        </div>
        <div class="stat-box">
          <div class="label">Pr√≥ximas (7 dias)</div>
          <div
            class="number"
            id="upcomingCount"
            style="color: var(--primary-blue)"
          >
            3
          </div>
        </div>
      </div>

      <div class="action-buttons">
        <button class="btn btn-primary" onclick="openNewMaintenanceModal()">
          ‚ûï Nova Manuten√ß√£o
        </button>
        <button class="btn btn-primary" onclick="openChecklistModal()">
          üìã Checklist
        </button>
        <button class="btn btn-primary" onclick="generateReport()">
          üìÑ Relat√≥rio
        </button>
      </div>

      <div class="cmms-grid">
        <div class="cmms-card">
          <h3>üìÖ Ordens de Manuten√ß√£o</h3>

          <div id="maintenanceList">
            <div style="text-align: center; padding: 40px; color: #999">
              ‚è≥ Carregando ordens de manuten√ß√£o...
            </div>
          </div>
        </div>

        <div>
          <div class="calendar-view">
            <h3 style="color: var(--primary-blue); margin-bottom: 10px">
              Novembro 2025
            </h3>
            <div class="calendar-grid">
              <div style="font-weight: bold; text-align: center">Dom</div>
              <div style="font-weight: bold; text-align: center">Seg</div>
              <div style="font-weight: bold; text-align: center">Ter</div>
              <div style="font-weight: bold; text-align: center">Qua</div>
              <div style="font-weight: bold; text-align: center">Qui</div>
              <div style="font-weight: bold; text-align: center">Sex</div>
              <div style="font-weight: bold; text-align: center">S√°b</div>

              <div class="calendar-day"></div>
              <div class="calendar-day"></div>
              <div class="calendar-day"></div>
              <div class="calendar-day"></div>
              <div class="calendar-day"></div>
              <div class="calendar-day">1</div>
              <div class="calendar-day">2</div>
              <div class="calendar-day">3</div>
              <div class="calendar-day">4</div>
              <div class="calendar-day">5</div>
              <div class="calendar-day">6</div>
              <div class="calendar-day">7</div>
              <div class="calendar-day">8</div>
              <div class="calendar-day">9</div>
              <div class="calendar-day">10</div>
              <div class="calendar-day">11</div>
              <div class="calendar-day">12</div>
              <div class="calendar-day">13</div>
              <div class="calendar-day">14</div>
              <div class="calendar-day has-event">15</div>
              <div class="calendar-day has-event">16</div>
              <div class="calendar-day has-event">17</div>
              <div class="calendar-day today">18</div>
              <div class="calendar-day">19</div>
              <div class="calendar-day has-event">20</div>
              <div class="calendar-day">21</div>
              <div class="calendar-day has-event">22</div>
              <div class="calendar-day">23</div>
              <div class="calendar-day">24</div>
              <div class="calendar-day">25</div>
              <div class="calendar-day">26</div>
              <div class="calendar-day">27</div>
              <div class="calendar-day">28</div>
              <div class="calendar-day">29</div>
              <div class="calendar-day">30</div>
            </div>
          </div>

          <div class="cmms-card" style="margin-top: 20px">
            <h3>üìä Estat√≠sticas</h3>
            <div id="maintenanceStats" style="font-size: 14px; line-height: 2">
              <div>
                ‚úÖ Taxa de Conclus√£o: <strong id="completionRate">-</strong>
              </div>
              <div>‚è±Ô∏è Tempo M√©dio: <strong id="avgTime">-</strong></div>
              <div>
                üîÑ Preventivas/Corretivas:
                <strong id="preventiveCorrective">-</strong>
              </div>
              <div>
                üìà Total de Ordens (M√™s): <strong id="totalOrders">-</strong>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Nova Manuten√ß√£o -->
    <div class="modal" id="newMaintenanceModal">
      <div class="modal-content">
        <h2 style="color: var(--primary-blue); margin-bottom: 20px">
          Nova Ordem de Manuten√ß√£o
        </h2>
        <form id="maintenanceForm">
          <div class="form-group">
            <label>T√≠tulo</label>
            <input
              type="text"
              placeholder="Ex: Inspe√ß√£o trimestral sensor RCON"
              required
            />
          </div>
          <div class="form-group">
            <label>Tipo</label>
            <select>
              <option>Preventiva</option>
              <option>Corretiva</option>
              <option>Preditiva</option>
              <option>Inspe√ß√£o</option>
              <option>Calibra√ß√£o</option>
            </select>
          </div>
          <div class="form-group">
            <label>Local/Equipamento</label>
            <select>
              <option>RCON - Reservat√≥rio Consumo</option>
              <option>RCAV - Reservat√≥rio Inc√™ndio</option>
              <option>RB03 - Casa de Bombas</option>
              <option>IE01 - Cisterna 01</option>
              <option>IE02 - Cisterna 02</option>
              <option>Bomba B03E</option>
              <option>Bomba B03D</option>
            </select>
          </div>
          <div class="form-group">
            <label>Data Prevista</label>
            <input type="date" required />
          </div>
          <div class="form-group">
            <label>Respons√°vel</label>
            <input type="text" placeholder="Nome do respons√°vel" />
          </div>
          <div class="form-group">
            <label>Descri√ß√£o</label>
            <textarea
              placeholder="Descreva os procedimentos a serem realizados..."
            ></textarea>
          </div>
          <div style="display: flex; gap: 10px; margin-top: 20px">
            <button type="submit" class="btn btn-primary">Criar Ordem</button>
            <button
              type="button"
              class="btn"
              style="background: var(--border-color)"
              onclick="closeModal('newMaintenanceModal')"
            >
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>

    <script src="assets/layout.js"></script>
    <script src="assets/api-service.js"></script>
    <script src="assets/ui-utils.js"></script>
    <script src="assets/app.js"></script>
    <script>
      let maintenanceOrders = [];
      let refreshInterval = null;

      // Carregar ordens de manuten√ß√£o baseadas em alertas
      async function loadMaintenanceOrders() {
        try {
          if (!window.apiService) {
            console.warn("[Manuten√ß√£o] API Service n√£o dispon√≠vel");
            return;
          }

          // Buscar alertas que podem gerar ordens de manuten√ß√£o
          const alerts = await window.apiService.getAlerts({ limit: 100 });

          // Buscar status dos sensores para detectar problemas
          const sensorsStatus = await window.apiService.getSensorsStatus();

          // Gerar ordens de manuten√ß√£o baseadas em alertas e status
          maintenanceOrders = [];

          // Processar alertas cr√≠ticos e de aviso como ordens de manuten√ß√£o
          if (alerts && alerts.length > 0) {
            alerts.forEach((alert) => {
              if (
                alert.nivel === "critical" ||
                alert.nivel === "error" ||
                alert.nivel === "warning"
              ) {
                const alertDate = new Date(alert.datetime);
                const daysSince = Math.floor(
                  (Date.now() - alertDate.getTime()) / (1000 * 60 * 60 * 24)
                );

                let status = "pending";
                let badgeClass = "badge-pending";
                let statusText = "Pendente";

                if (alert.resolvido) {
                  status = "completed";
                  badgeClass = "badge-completed";
                  statusText = "Conclu√≠da";
                } else if (daysSince > 7) {
                  status = "overdue";
                  badgeClass = "badge-overdue";
                  statusText = "Atrasada";
                }

                const tipo = alert.tipo || "Manuten√ß√£o";
                const elementoId =
                  alert.elemento_id || alert.sensor_id || "N/A";

                // Determinar tipo de manuten√ß√£o baseado no tipo de alerta
                let maintenanceType = "Corretiva";
                if (
                  tipo.includes("calibra√ß√£o") ||
                  tipo.includes("calibration")
                ) {
                  maintenanceType = "Calibra√ß√£o";
                } else if (
                  tipo.includes("inspe√ß√£o") ||
                  tipo.includes("inspection")
                ) {
                  maintenanceType = "Inspe√ß√£o";
                }

                maintenanceOrders.push({
                  id: alert.alerta_id || Date.now(),
                  titulo: `${maintenanceType} - ${elementoId}`,
                  tipo: maintenanceType,
                  elemento_id: elementoId,
                  status: status,
                  badgeClass: badgeClass,
                  statusText: statusText,
                  mensagem:
                    alert.mensagem || alert.tipo || "Manuten√ß√£o necess√°ria",
                  data_prevista: alertDate.toLocaleDateString("pt-BR"),
                  dias_atraso: daysSince > 7 ? daysSince - 7 : 0,
                  dias_faltando: daysSince < 0 ? Math.abs(daysSince) : null,
                  resolvido: alert.resolvido || false,
                  data_resolucao: alert.data_resolucao || null,
                });
              }
            });
          }

          // Adicionar ordens baseadas em sensores offline
          if (sensorsStatus && sensorsStatus.length > 0) {
            sensorsStatus.forEach((sensor) => {
              if (
                sensor.estado_conexao === "offline" ||
                sensor.estado_conexao === "warning"
              ) {
                const elementoId = sensor.elemento_id || sensor.sensor_id;
                const lastReading = sensor.ultima_leitura
                  ? new Date(sensor.ultima_leitura)
                  : null;
                const daysSince = lastReading
                  ? Math.floor(
                      (Date.now() - lastReading.getTime()) /
                        (1000 * 60 * 60 * 24)
                    )
                  : 999;

                // Verificar se j√° existe ordem para este sensor
                const exists = maintenanceOrders.some(
                  (o) =>
                    o.elemento_id === elementoId && o.titulo.includes("Sensor")
                );

                if (!exists && daysSince > 1) {
                  maintenanceOrders.push({
                    id: `sensor-${elementoId}-${Date.now()}`,
                    titulo: `Verifica√ß√£o Sensor ${elementoId}`,
                    tipo: "Preventiva",
                    elemento_id: elementoId,
                    status: daysSince > 7 ? "overdue" : "pending",
                    badgeClass:
                      daysSince > 7 ? "badge-overdue" : "badge-pending",
                    statusText: daysSince > 7 ? "Atrasada" : "Pendente",
                    mensagem: `Sensor ${elementoId} offline h√° ${daysSince} dia(s)`,
                    data_prevista: lastReading
                      ? lastReading.toLocaleDateString("pt-BR")
                      : new Date().toLocaleDateString("pt-BR"),
                    dias_atraso: daysSince > 7 ? daysSince - 7 : 0,
                    dias_faltando: null,
                    resolvido: false,
                    data_resolucao: null,
                  });
                }
              }
            });
          }

          // Ordenar: atrasadas primeiro, depois pendentes, depois conclu√≠das
          maintenanceOrders.sort((a, b) => {
            if (a.status === "overdue" && b.status !== "overdue") return -1;
            if (a.status !== "overdue" && b.status === "overdue") return 1;
            if (a.status === "pending" && b.status === "completed") return -1;
            if (a.status === "completed" && b.status === "pending") return 1;
            return 0;
          });

          renderMaintenanceList();
          updateMaintenanceStats();
        } catch (error) {
          console.error("[Manuten√ß√£o] Erro ao carregar ordens:", error);
          const listEl = document.getElementById("maintenanceList");
          if (listEl) {
            listEl.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #ef4444;">
                            ‚ùå Erro ao carregar ordens de manuten√ß√£o: ${
                              error.message || "Erro desconhecido"
                            }
                        </div>
                    `;
          }
        }
      }

      // Renderizar lista de manuten√ß√£o
      function renderMaintenanceList() {
        const listEl = document.getElementById("maintenanceList");
        if (!listEl) return;

        if (maintenanceOrders.length === 0) {
          listEl.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #999;">
                        ‚úÖ Nenhuma ordem de manuten√ß√£o pendente
                    </div>
                `;
          return;
        }

        listEl.innerHTML = maintenanceOrders
          .map((order) => {
            const statusInfo =
              order.status === "overdue"
                ? `‚ö†Ô∏è Atrasada h√° ${order.dias_atraso} dia(s)`
                : order.status === "pending" && order.dias_faltando
                ? `‚è∞ Em ${order.dias_faltando} dia(s)`
                : order.status === "completed"
                ? `‚úÖ Conclu√≠da em: ${
                    order.data_resolucao
                      ? new Date(order.data_resolucao).toLocaleDateString(
                          "pt-BR"
                        )
                      : "-"
                  }`
                : `‚è∞ Pendente`;

            const sensorName =
              window.SENSORS?.[order.elemento_id]?.name || order.elemento_id;

            return `
                    <div class="maintenance-item ${order.status}">
                        <div class="maintenance-header">
                            <div class="maintenance-title">${order.titulo}</div>
                            <span class="maintenance-badge ${order.badgeClass}">${order.statusText}</span>
                        </div>
                        <div class="maintenance-details">
                            <div>üìç ${sensorName}</div>
                            <div>üïê ${order.data_prevista} | ${statusInfo}</div>
                            <div>üìã ${order.mensagem}</div>
                        </div>
                    </div>
                `;
          })
          .join("");
      }

      // Atualizar estat√≠sticas
      function updateMaintenanceStats() {
        const overdue = maintenanceOrders.filter(
          (o) => o.status === "overdue"
        ).length;
        const pending = maintenanceOrders.filter(
          (o) => o.status === "pending"
        ).length;
        const completed = maintenanceOrders.filter(
          (o) => o.status === "completed"
        ).length;
        const upcoming = maintenanceOrders.filter((o) => {
          if (o.status !== "pending") return false;
          const orderDate = new Date(o.data_prevista);
          const daysUntil = Math.ceil(
            (orderDate.getTime() - Date.now()) / (1000 * 60 * 60 * 24)
          );
          return daysUntil >= 0 && daysUntil <= 7;
        }).length;

        document.getElementById("overdueCount").textContent = overdue;
        document.getElementById("pendingCount").textContent = pending;
        document.getElementById("completedCount").textContent = completed;
        document.getElementById("upcomingCount").textContent = upcoming;

        // Atualizar estat√≠sticas gerais
        const total = maintenanceOrders.length;
        const completionRate =
          total > 0 ? Math.round((completed / total) * 100) : 0;
        const preventive = maintenanceOrders.filter(
          (o) => o.tipo === "Preventiva"
        ).length;
        const corrective = maintenanceOrders.filter(
          (o) => o.tipo === "Corretiva"
        ).length;

        document.getElementById("completionRate").textContent =
          completionRate + "%";
        document.getElementById("avgTime").textContent = "2.5 horas"; // Placeholder
        document.getElementById("preventiveCorrective").textContent =
          total > 0
            ? `${Math.round((preventive / total) * 100)}% / ${Math.round(
                (corrective / total) * 100
              )}%`
            : "-";
        document.getElementById("totalOrders").textContent = total;
      }

      function openNewMaintenanceModal() {
        document.getElementById("newMaintenanceModal").classList.add("active");
      }

      function openChecklistModal() {
        alert("Checklist de manuten√ß√£o ser√° implementado em breve");
      }

      function generateReport() {
        if (maintenanceOrders.length === 0) {
          alert("Nenhuma ordem de manuten√ß√£o para gerar relat√≥rio");
          return;
        }

        // Gerar CSV simples
        const csv = [
          "T√≠tulo,Tipo,Elemento,Status,Data Prevista,Mensagem",
          ...maintenanceOrders.map(
            (o) =>
              `"${o.titulo}","${o.tipo}","${o.elemento_id}","${o.statusText}","${o.data_prevista}","${o.mensagem}"`
          ),
        ].join("\n");

        const blob = new Blob([csv], { type: "text/csv" });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `manutencao-${new Date().toISOString().split("T")[0]}.csv`;
        a.click();
        window.URL.revokeObjectURL(url);
      }

      function closeModal(modalId) {
        document.getElementById(modalId).classList.remove("active");
      }

      // Close modal on background click
      document.querySelectorAll(".modal").forEach((modal) => {
        modal.addEventListener("click", (e) => {
          if (e.target === modal) {
            modal.classList.remove("active");
          }
        });
      });

      // Form submission
      document
        .getElementById("maintenanceForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const formData = new FormData(e.target);
          const titulo = e.target.querySelector('input[type="text"]').value;
          const tipo = e.target.querySelector("select").value;
          const local = e.target.querySelectorAll("select")[1].value;
          const dataPrevista =
            e.target.querySelector('input[type="date"]').value;
          const responsavel =
            e.target.querySelectorAll('input[type="text"]')[1].value;
          const descricao = e.target.querySelector("textarea").value;

          // Criar ordem de manuten√ß√£o (por enquanto apenas local)
          const newOrder = {
            id: Date.now(),
            titulo: titulo,
            tipo: tipo,
            elemento_id: local.split(" - ")[0],
            status: "pending",
            badgeClass: "badge-pending",
            statusText: "Pendente",
            mensagem: descricao || "Nova ordem de manuten√ß√£o",
            data_prevista: new Date(dataPrevista).toLocaleDateString("pt-BR"),
            dias_atraso: 0,
            dias_faltando: null,
            resolvido: false,
            data_resolucao: null,
          };

          maintenanceOrders.unshift(newOrder);
          renderMaintenanceList();
          updateMaintenanceStats();

          alert("Ordem de manuten√ß√£o criada com sucesso!");
          closeModal("newMaintenanceModal");
          e.target.reset();
        });

      // Inicializar
      async function init() {
        console.log("[Manuten√ß√£o] Inicializando p√°gina...");

        // Aguardar API Service
        let attempts = 0;
        while (!window.apiService && attempts < 50) {
          await new Promise((resolve) => setTimeout(resolve, 100));
          attempts++;
        }

        if (!window.apiService) {
          console.error("[Manuten√ß√£o] API Service n√£o carregou");
          return;
        }

        // Carregar ordens iniciais
        await loadMaintenanceOrders();

        // Auto-refresh a cada 60 segundos
        if (refreshInterval) {
          clearInterval(refreshInterval);
        }
        refreshInterval = setInterval(loadMaintenanceOrders, 60000);

        console.log("[Manuten√ß√£o] P√°gina inicializada com sucesso");
      }

      // Limpar intervalo ao sair da p√°gina
      window.addEventListener("beforeunload", () => {
        if (refreshInterval) {
          clearInterval(refreshInterval);
        }
      });

      // Iniciar quando DOM estiver pronto
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", init);
      } else {
        init();
      }
    </script>
  </body>
</html>
